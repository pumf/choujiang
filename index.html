<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âπ¥‰ºöÊäΩÂ•ñÁ≥ªÁªü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            overflow: hidden;
        }

        .toggle-prize-btn {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 80px;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            border: none;
            border-radius: 0 10px 10px 0;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            z-index: 100;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            letter-spacing: 3px;
            box-shadow: 5px 0 20px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
        }

        .toggle-prize-btn:hover {
            width: 35px;
            box-shadow: 8px 0 30px rgba(255, 107, 107, 0.6);
        }

        .prize-panel {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(30px);
            padding: 20px;
            z-index: 99;
            transform: translateX(-100%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        .prize-panel.active {
            transform: translateX(0);
        }

        .prize-panel h2 {
            font-size: 1.3em;
            color: #feca57;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(254, 202, 87, 0.3);
        }

        .prize-list {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }

        .prize-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #ff6b6b;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .prize-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .prize-item.active {
            border-left-color: #feca57;
            background: rgba(254, 202, 87, 0.15);
        }

        .prize-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .prize-item .name {
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .prize-item .desc {
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 6px;
        }

        .prize-item .info {
            display: flex;
            justify-content: space-between;
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.6);
        }

        .prize-item .status {
            padding: 2px 8px;
            border-radius: 10px;
            background: linear-gradient(45deg, #1dd1a1, #10ac84);
            font-size: 0.7em;
        }

        .prize-item .status.awarded {
            background: linear-gradient(45deg, #ff6b6b, #ee5a5a);
        }

        .main-content {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: -1;
        }

        .title {
            font-size: 3.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #ff6b6b);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientMove 4s ease infinite;
            text-shadow: 0 0 60px rgba(255, 107, 107, 0.3);
            margin-bottom: 20px;
        }

        @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .title {
            font-size: 3.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #ff6b6b);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientMove 4s ease infinite;
            text-shadow: 0 0 60px rgba(255, 107, 107, 0.3);
            margin-bottom: 20px;
        }

        .people-area {
            flex: 1;
            width: 100%;
            max-width: 1200px;
            padding: 25px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .people-area h3 {
            color: #48dbfb;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .people-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 12px;
            overflow-y: auto;
            padding: 5px;
        }

        .people-grid::-webkit-scrollbar {
            width: 6px;
        }

        .people-grid::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border-radius: 3px;
        }

        .red-packet {
            aspect-ratio: 1;
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            position: relative;
            overflow: hidden;
            border: none;
        }

        .red-packet::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #f1c40f, #f39c12);
            border-radius: 50%;
        }

        .red-packet::after {
            content: 'Á¶è';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.3em;
            font-weight: bold;
            color: #c0392b;
            z-index: 1;
        }

        .red-packet .name {
            position: absolute;
            bottom: 8px;
            left: 4px;
            right: 4px;
            text-align: center;
            font-size: 0.7em;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            z-index: 2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .red-packet:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.6);
        }

        .red-packet.won {
            background: linear-gradient(145deg, #f1c40f, #f39c12);
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.4);
        }

        .red-packet.won::before {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
        }

        .red-packet.won::after {
            content: '‰∏≠';
            color: #fff;
        }

        .lottery-btn {
            padding: 18px 60px;
            font-size: 1.4em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: #fff;
            transition: all 0.3s ease;
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.4);
            margin-top: 20px;
        }

        .lottery-btn:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 60px rgba(255, 107, 107, 0.6);
        }

        .lottery-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }

        .lottery-btn.running {
            background: linear-gradient(45deg, #1dd1a1, #10ac84);
            animation: pulse 0.8s ease infinite alternate;
        }

        @keyframes pulse {
            from { box-shadow: 0 10px 40px rgba(29, 209, 161, 0.4); }
            to { box-shadow: 0 15px 70px rgba(29, 209, 161, 0.7); }
        }

        .settings-btn {
            position: fixed;
            left: 20px;
            bottom: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg) scale(1.1);
        }

        .settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .settings-panel.active {
            display: flex;
        }

        .settings-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .settings-content h2 {
            color: #feca57;
            margin-bottom: 25px;
            text-align: center;
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section h3 {
            color: #48dbfb;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-section input, .settings-section textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .settings-section input:focus, .settings-section textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: #fff;
            transition: all 0.3s ease;
        }

        .btn-primary { background: linear-gradient(45deg, #ff6b6b, #feca57); }
        .btn-secondary { background: linear-gradient(45deg, #48dbfb, #0abde3); }
        .btn-danger { background: linear-gradient(45deg, #ff6b6b, #ee5a5a); }
        .btn-success { background: linear-gradient(45deg, #1dd1a1, #10ac84); }

        .btn:hover { transform: translateY(-2px); }

        .close-settings {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-settings:hover { transform: rotate(90deg); }

        .bg-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .bg-option {
            height: 45px;
            border-radius: 10px;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .bg-option.active {
            border-color: #feca57;
        }

        .file-upload {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px 0;
        }

        .file-upload:hover {
            border-color: #feca57;
            background: rgba(254, 202, 87, 0.1);
        }

        .file-upload input {
            display: none;
        }

        .ball-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            perspective: 1200px;
        }

        .ball-container.active {
            display: flex;
        }

        #lottery-ball {
            width: 850px;
            height: 850px;
            position: relative;
            transform-style: preserve-3d;
        }

        @keyframes rotateY {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }

        .ball-item {
            position: absolute;
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            border-radius: 12px;
            transform-style: preserve-3d;
            backface-visibility: hidden;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .ball-item::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 35px;
            height: 35px;
            background: linear-gradient(145deg, #f1c40f, #f39c12);
            border-radius: 50%;
            transform: translate(-50%, -50%) translateZ(1px);
        }

        .ball-item::after {
            content: 'Á¶è';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateZ(1px);
            font-size: 18px;
            font-weight: bold;
            color: #c0392b;
            z-index: 1;
        }

        .ball-item .name {
            position: absolute;
            bottom: 5px;
            left: 3px;
            right: 3px;
            text-align: center;
            font-size: 10px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 2;
            transform: translateZ(2px);
        }

        .ball-item .thickness {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #c0392b, #a93226);
            border-radius: 12px;
            transform: translateZ(-8px);
        }

        .ball-item.gather {
            position: absolute;
            top: 50%;
            left: 50%;
        }

        .ball-item.highlight {
            background: linear-gradient(145deg, #f1c40f, #f39c12);
            box-shadow: 0 0 35px rgba(254, 202, 87, 0.9);
            z-index: 1000;
        }

        .fullscreen-btn {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .stop-btn, .cancel-btn {
            position: absolute;
            bottom: 60px;
            padding: 18px 45px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0;
            transform: translateY(20px);
        }

        .ball-container.active .stop-btn,
        .ball-container.active .cancel-btn {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.5s ease 1s;
        }

        .stop-btn {
            left: calc(50% - 250px);
            background: linear-gradient(45deg, #1dd1a1, #10ac84);
            box-shadow: 0 5px 30px rgba(29, 209, 161, 0.4);
        }

        .cancel-btn {
            left: calc(50% + 50px);
            background: linear-gradient(45deg, #ff6b6b, #ee5a5a);
            box-shadow: 0 5px 30px rgba(255, 107, 107, 0.4);
        }

        .stop-btn:hover, .cancel-btn:hover {
            transform: scale(1.05);
        }

        .stop-btn:active, .cancel-btn:active {
            transform: scale(0.95);
        }

        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.4);
        }

        .empty-state .icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .title { font-size: 2.2em; }
            .stats-bar { gap: 15px; }
            .stat-item { padding: 10px 20px; }
            .stat-item .number { font-size: 1.5em; }
            .lottery-btn { padding: 20px 60px; font-size: 1.5em; }
            .people-grid { grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); }
            .prize-panel { width: 260px; }
        }
    </style>
</head>
<body>
    <div class="bg-overlay" id="bg-overlay"></div>
    <button class="toggle-prize-btn" id="toggle-prize-btn">Â•ñÈ°πÂàóË°®</button>

    <div class="prize-panel" id="prize-panel">
        <h2>üèÜ Â•ñÈ°πÂàóË°®</h2>
        <div class="prize-list" id="prize-list">
            <div class="empty-state">
                <div class="icon">üèÜ</div>
                <p>ÊöÇÊó†Â•ñÈ°π</p>
            </div>
        </div>
    </div>

    <div class="main-content">
        <h1 class="title" id="lottery-title">üéâ Âπ¥‰ºöÊäΩÂ•ñÁ≥ªÁªü üéä</h1>

        <div class="people-area">
            <div class="people-grid" id="people-grid">
                <div class="empty-state">
                    <div class="icon">üë•</div>
                    <p>ÊöÇÊó†‰∫∫ÂëòÔºåËØ∑Âú®ËÆæÁΩÆ‰∏≠Ê∑ªÂä†</p>
                </div>
            </div>
        </div>

        <button class="lottery-btn" id="lottery-btn" onclick="startLottery()">üé∞ ÂºÄÂßãÊäΩÂ•ñ</button>
    </div>

    <button class="settings-btn" id="settings-btn" onclick="showSettings()">‚öôÔ∏è</button>
    <button class="fullscreen-btn" id="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂</button>

    <div class="ball-container" id="ball-container">
        <div id="lottery-ball"></div>
        <button class="stop-btn" id="stop-btn">üõë ÂÅúÊ≠¢ÊäΩÂ•ñ</button>
        <button class="cancel-btn" id="cancel-btn">‚ùå ÂèñÊ∂à</button>
    </div>

    <div class="winner-modal" id="winner-modal">
        <div class="winner-content">
            <h2 id="winner-title">üéâ ÊÅ≠Âñú‰∏≠Â•ñ üéâ</h2>
            <div class="prize-name" id="winner-prize"></div>
            <div class="winner-names" id="winner-names"></div>
            <div class="close-hint">ÁÇπÂáª‰ªªÊÑè‰ΩçÁΩÆÂÖ≥Èó≠</div>
        </div>
    </div>

    <div id="fireworks-container"></div>

    <div class="settings-panel" id="settings-panel">
        <span class="close-settings" onclick="closeSettings()">&times;</span>
        <div class="settings-content">
            <h2>‚öôÔ∏è Á≥ªÁªüËÆæÁΩÆ</h2>

            <div class="settings-section">
                <h3>üìù Ê†áÈ¢òËÆæÁΩÆ</h3>
                <input type="text" id="setting-title" placeholder="ËæìÂÖ•ÊäΩÂ•ñÊ†áÈ¢ò">
                <button class="btn btn-primary" onclick="saveTitle()">‰øùÂ≠òÊ†áÈ¢ò</button>
            </div>

            <div class="settings-section">
                <h3>üé® ËÉåÊôØËÆæÁΩÆ</h3>
                <div class="bg-options">
                    <div class="bg-option active" data-bg="gradient1" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);"></div>
                    <div class="bg-option" data-bg="gradient2" style="background: linear-gradient(135deg, #0f4037 0%, #195047 50%, #0f4037 100%);"></div>
                    <div class="bg-option" data-bg="gradient3" style="background: linear-gradient(135deg, #4a1a1a 0%, #3d1a1a 50%, #2a0f0f 100%);"></div>
                    <div class="bg-option" data-bg="gradient4" style="background: linear-gradient(135deg, #1a2a4a 0%, #1a2040 50%, #0f1a2a 100%);"></div>
                </div>
                <div class="file-upload" onclick="document.getElementById('bg-file').click()" style="margin-top:15px;">
                    <input type="file" id="bg-file" accept="image/*" onchange="uploadBgImage(event)">
                    <p>üì∑ ‰∏ä‰º†Êú¨Âú∞ËÉåÊôØÂõæÁâá</p>
                    <p style="font-size:12px;color:rgba(255,255,255,0.5)">ÊîØÊåÅ jpg„ÄÅpng„ÄÅgif</p>
                </div>
                <button class="btn btn-secondary" onclick="clearBgImage()" style="margin-top:10px;">Ê∏ÖÈô§ËÉåÊôØÂõæÁâá</button>
            </div>

            <div class="settings-section">
                <h3>üèÜ Â•ñÈ°πÁÆ°ÁêÜ</h3>
                <input type="text" id="setting-prize-name" placeholder="Â•ñÈ°πÂêçÁß∞">
                <input type="text" id="setting-prize-desc" placeholder="Â•ñÂìÅÊèèËø∞">
                <div style="display:flex;gap:10px;margin-bottom:10px;">
                    <input type="number" id="setting-prize-count" value="1" min="1" placeholder="‰∫∫Êï∞" style="flex:1;">
                    <input type="color" id="setting-prize-color" value="#ff6b6b" style="width:50px;height:42px;padding:2px;border-radius:8px;cursor:pointer;">
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="addPrizeFromSettings()">Ê∑ªÂä†Â•ñÈ°π</button>
                    <button class="btn btn-secondary" onclick="clearPrizes()">Ê∏ÖÁ©∫Â•ñÈ°π</button>
                </div>
            </div>

            <div class="settings-section">
                <h3>üë• ‰∫∫ÂëòÁÆ°ÁêÜ</h3>
                <textarea id="add-people-text" rows="4" placeholder="ÊØèË°å‰∏Ä‰∏™ÂßìÂêç"></textarea>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="addPeople()">Ê∑ªÂä†‰∫∫Âëò</button>
                    <button class="btn btn-secondary" onclick="showImportModal()">ÂØºÂÖ•</button>
                    <button class="btn btn-success" onclick="exportPeople()">ÂØºÂá∫</button>
                    <button class="btn btn-danger" onclick="clearPeople()">Ê∏ÖÁ©∫</button>
                </div>
            </div>

            <div class="settings-section">
                <h3>üíæ Êï∞ÊçÆÁÆ°ÁêÜ</h3>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="exportAll()">ÂØºÂá∫ÂÖ®ÈÉ®</button>
                    <button class="btn btn-secondary" onclick="showImportAllModal()">ÂØºÂÖ•ÂÖ®ÈÉ®</button>
                    <button class="btn btn-danger" onclick="clearAll()">Ê∏ÖÁ©∫ÊâÄÊúâ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="settings-panel" id="import-modal">
        <span class="close-settings" onclick="closeImportModal()">&times;</span>
        <div class="settings-content">
            <h3>ÂØºÂÖ•‰∫∫Âëò</h3>
            <div class="file-upload" onclick="document.getElementById('import-file').click()">
                <input type="file" id="import-file" accept=".txt,.csv,.json">
                <p>ÁÇπÂáªÈÄâÊã©Êñá‰ª∂</p>
                <p style="font-size:12px;color:rgba(255,255,255,0.5)">ÊîØÊåÅ txt„ÄÅcsv„ÄÅjson</p>
            </div>
        </div>
    </div>

    <div class="settings-panel" id="import-all-modal">
        <span class="close-settings" onclick="closeImportAllModal()">&times;</span>
        <div class="settings-content">
            <h3>ÂØºÂÖ•ÂÖ®ÈÉ®ÈÖçÁΩÆ</h3>
            <div class="file-upload" onclick="document.getElementById('import-all-file').click()">
                <input type="file" id="import-all-file" accept=".json">
                <p>ÁÇπÂáªÈÄâÊã©ÈÖçÁΩÆÊñá‰ª∂</p>
                <p style="font-size:12px;color:rgba(255,255,255,0.5)">‰ªÖÊîØÊåÅ json Ê†ºÂºè</p>
            </div>
        </div>
    </div>

    <script>
        let people = [];
        let prizes = [];
        let history = [];
        let settings = { title: 'üéâ Âπ¥‰ºöÊäΩÂ•ñÁ≥ªÁªü üéä', background: 'gradient1' };
        let currentPrizeIndex = null;
        let isLotteryRunning = false;
        let animationId = null;
        let currentAnimationData = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderAll();
            initBgOptions();
            document.getElementById('toggle-prize-btn').addEventListener('click', togglePrizePanel);
            document.getElementById('settings-btn').addEventListener('click', showSettings);
            document.getElementById('stop-btn').addEventListener('click', stopLottery);
            document.getElementById('cancel-btn').addEventListener('click', cancelLottery);
            document.getElementById('fullscreen-btn').addEventListener('click', toggleFullscreen);
        });

        function loadData() {
            const savedData = localStorage.getItem('lotteryData');
            if (savedData) {
                const data = JSON.parse(savedData);
                people = data.people || [];
                prizes = data.prizes || [];
                history = data.history || [];
                settings = { ...settings, ...data.settings };
            }
        }

        function saveData() {
            const dataToSave = {
                people,
                prizes,
                history,
                settings: {
                    title: settings.title,
                    background: settings.background || 'gradient1'
                }
            };
            localStorage.setItem('lotteryData', JSON.stringify(dataToSave));
        }

        function renderAll() {
            renderTitle();
            renderBg();
            renderPrizes();
            renderPeople();
        }

        function renderTitle() {
            document.getElementById('lottery-title').textContent = settings.title;
            document.getElementById('setting-title').value = settings.title.replace(/üéâ|üéä/g, '').trim();
        }

        function renderBg() {
            document.body.style.background = getBgStyle(settings.background);
            document.querySelectorAll('.bg-option').forEach(el => {
                el.classList.toggle('active', el.dataset.bg === settings.background);
            });
        }

        function uploadBgImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                document.querySelector('.main-content').style.backgroundImage = `url(${e.target.result})`;
                document.getElementById('bg-overlay').style.background = 'rgba(0, 0, 0, 0.3)';
                alert('ËÉåÊôØÂõæÁâáÂ∑≤ËÆæÁΩÆÔºà‰ªÖÂΩìÂâç‰ºöËØùÊúâÊïàÔºâ');
            };
            reader.readAsDataURL(file);
        }

        function clearBgImage() {
            document.querySelector('.main-content').style.backgroundImage = 'none';
            document.getElementById('bg-overlay').style.background = 'rgba(0, 0, 0, 0.5)';
            alert('ËÉåÊôØÂõæÁâáÂ∑≤Ê∏ÖÈô§');
        }

        function getBgStyle(bg) {
            const styles = {
                gradient1: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
                gradient2: 'linear-gradient(135deg, #0f4037 0%, #195047 50%, #0f4037 100%)',
                gradient3: 'linear-gradient(135deg, #4a1a1a 0%, #3d1a1a 50%, #2a0f0f 100%)',
                gradient4: 'linear-gradient(135deg, #1a2a4a 0%, #1a2040 50%, #0f1a2a 100%)'
            };
            return styles[bg] || styles.gradient1;
        }

        function initBgOptions() {
            document.querySelectorAll('.bg-option').forEach(option => {
                option.addEventListener('click', () => {
                    settings.background = option.dataset.bg;
                    saveData();
                    renderBg();
                });
            });
        }

        function renderStats() {
            const total = people.length;
            const won = people.filter(p => p.prize).length;
            document.getElementById('total-count').textContent = total;
            document.getElementById('won-count').textContent = won;
            document.getElementById('remain-count').textContent = total - won;
        }

        function renderPrizes() {
            const container = document.getElementById('prize-list');
            if (prizes.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üèÜ</div><p>ÊöÇÊó†Â•ñÈ°π</p></div>';
                return;
            }
            container.innerHTML = prizes.map((prize, index) => {
                const winners = people.filter(p => p.prize === prize.name);
                return `
                <div class="prize-item ${prize.awarded ? 'disabled' : ''} ${currentPrizeIndex === index ? 'active' : ''}"
                     onclick="selectPrize(${index})" style="border-left-color: ${prize.color}">
                    <div class="name" style="color: ${prize.color}">${prize.name}</div>
                    <div class="desc">${prize.desc}</div>
                    <div class="info">
                        <span>üë§ ${prize.count}‰∫∫</span>
                        <span class="status ${prize.awarded ? 'awarded' : ''}">${prize.awarded ? 'Â∑≤ÊäΩÂèñ' : 'ÂæÖÊäΩÂèñ'}</span>
                    </div>
                    ${winners.length > 0 ? `<div class="desc" style="margin-top:8px;color:#feca57;">‰∏≠Â•ñ: ${winners.map(w => w.name).join('„ÄÅ')}</div>` : ''}
                </div>
            `;
            }).join('');
        }

        function selectPrize(index) {
            if (prizes[index].awarded) return;
            currentPrizeIndex = currentPrizeIndex === index ? null : index;
            renderPrizes();
        }

        function renderPeople() {
            const container = document.getElementById('people-grid');
            if (people.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üë•</div><p>ÊöÇÊó†‰∫∫ÂëòÔºåËØ∑Âú®ËÆæÁΩÆ‰∏≠Ê∑ªÂä†</p></div>';
                return;
            }
            container.innerHTML = people.map((person, index) => `
                <div class="red-packet ${person.prize ? 'won' : ''}" onclick="showPersonInfo(${index})" title="${person.name}">
                    <span class="name">${person.name}</span>
                </div>
            `).join('');
        }

        function showPersonInfo(index) {
            const person = people[index];
            alert(person.prize ? `${person.name}\nÂ∑≤‰∏≠Â•ñ: ${person.prize}` : `${person.name}\nÁä∂ÊÄÅ: ÂæÖÊäΩÂ•ñ`);
        }

        function togglePrizePanel() {
            document.getElementById('prize-panel').classList.toggle('active');
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function addPrize() {
            const name = document.getElementById('prize-name').value.trim();
            const desc = document.getElementById('prize-desc').value.trim();
            const count = parseInt(document.getElementById('prize-count').value);
            const color = document.getElementById('prize-color').value;

            if (!name) { alert('ËØ∑ËæìÂÖ•Â•ñÈ°πÂêçÁß∞'); return; }

            prizes.push({ id: Date.now(), name, desc, count, color, awarded: false });
            saveData();
            renderPrizes();

            document.getElementById('prize-name').value = '';
            document.getElementById('prize-desc').value = '';
            document.getElementById('prize-count').value = '1';
        }

        function addPrizeFromSettings() {
            const name = document.getElementById('setting-prize-name').value.trim();
            const desc = document.getElementById('setting-prize-desc').value.trim();
            const count = parseInt(document.getElementById('setting-prize-count').value);
            const color = document.getElementById('setting-prize-color').value;

            if (!name) { alert('ËØ∑ËæìÂÖ•Â•ñÈ°πÂêçÁß∞'); return; }

            prizes.push({ id: Date.now(), name, desc, count, color, awarded: false });
            saveData();
            renderPrizes();

            document.getElementById('setting-prize-name').value = '';
            document.getElementById('setting-prize-desc').value = '';
            document.getElementById('setting-prize-count').value = '1';
            alert('Â•ñÈ°πÊ∑ªÂä†ÊàêÂäü');
        }

        function clearPrizes() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂ•ñÈ°πÂêóÔºü')) {
                prizes = [];
                saveData();
                renderPrizes();
            }
        }

        function startLottery() {
            console.log('ÂºÄÂßãÊäΩÂ•ñÊåâÈíÆË¢´ÁÇπÂáª');
            let prize;
            if (currentPrizeIndex !== null) {
                prize = prizes[currentPrizeIndex];
            } else {
                const availablePrizes = prizes.filter(p => !p.awarded);
                console.log('ÂèØÁî®Â•ñÈ°πÊï∞Èáè:', availablePrizes.length);
                if (availablePrizes.length === 0) { alert('ÊâÄÊúâÂ•ñÈ°πÈÉΩÂ∑≤ÊäΩÂèñÂÆåÊØïÔºÅ'); return; }
                prize = availablePrizes[Math.floor(Math.random() * availablePrizes.length)];
            }

            const availablePeople = people.filter(p => !p.prize);
            console.log('ÂèØÁî®‰∫∫ÂëòÊï∞Èáè:', availablePeople.length);
            if (availablePeople.length === 0) { alert('Ê≤°ÊúâÂèØÊäΩÂ•ñÁöÑ‰∫∫Âëò‰∫ÜÔºÅ'); return; }

            const btn = document.getElementById('lottery-btn');
            btn.disabled = true;
            btn.textContent = 'üé∞ ÊäΩÂ•ñ‰∏≠...';
            btn.classList.add('running');

            console.log('Ë∞ÉÁî®showGatherAnimation');
            showGatherAnimation(availablePeople, prize);
        }

        function showGatherAnimation(availablePeople, prize) {
            const container = document.getElementById('ball-container');
            const ball = document.getElementById('lottery-ball');
            container.classList.add('active');
            ball.innerHTML = '';
            ball.style.animation = 'none';
            ball.style.transform = 'rotateY(0deg)';

            currentAnimationData = { availablePeople, prize };

            const count = availablePeople.length;
            if (count === 0) {
                alert('Ê≤°ÊúâÂèØÊäΩÂ•ñÁöÑ‰∫∫Âëò‰∫ÜÔºÅ');
                container.classList.remove('active');
                return;
            }

            const radius = 380;
            const phi = Math.PI * (3 - Math.sqrt(5));

            for (let i = 0; i < count; i++) {
                const y = 1 - (i / (count - 1)) * 2;
                const radiusAtY = Math.sqrt(1 - y * y);
                const theta = phi * i;

                const x = Math.cos(theta) * radiusAtY * radius;
                const z = Math.sin(theta) * radiusAtY * radius;

                const item = document.createElement('div');
                item.className = 'ball-item gather';
                item.innerHTML = `<span class="name">${availablePeople[i].name}</span><div class="thickness"></div>`;
                item.dataset.theta = theta;
                item.dataset.yPos = y * radius;
                ball.appendChild(item);
            }

            setTimeout(() => {
                const items = ball.querySelectorAll('.ball-item');
                items.forEach((item, idx) => {
                    const x = parseFloat(Math.cos(item.dataset.theta) * Math.sqrt(1 - Math.pow(item.dataset.yPos / radius, 2)) * radius);
                    const y = parseFloat(item.dataset.yPos);
                    const z = parseFloat(Math.sin(item.dataset.theta) * Math.sqrt(1 - Math.pow(item.dataset.yPos / radius, 2)) * radius);
                    const theta = parseFloat(item.dataset.theta);

                    const angleX = 90;
                    const angleY = theta * (180 / Math.PI);

                    item.style.transform = `translate3d(${x}px, ${y}px, ${z}px) rotateX(${angleX}deg) rotateY(${angleY}deg)`;
                });
            }, 50);

            setTimeout(() => {
                ball.style.animation = 'rotateY 4s linear infinite';
            }, 1000);
        }

        function stopLottery() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            const ball = document.getElementById('lottery-ball');
            ball.style.animation = 'none';

            const { availablePeople, prize } = currentAnimationData;
            const winnerCount = Math.min(prize.count, availablePeople.length);
            const shuffled = [...availablePeople].sort(() => Math.random() - 0.5);
            const winners = shuffled.slice(0, winnerCount);

            winners.forEach(winner => {
                const index = people.findIndex(p => p.id === winner.id);
                if (index !== -1) people[index].prize = prize.name;
            });

            prize.awarded = true;
            history.unshift({
                prizeName: prize.name,
                prizeDesc: prize.desc,
                winners: winners.map(w => w.name),
                time: new Date().toISOString()
            });

            saveData();
            currentPrizeIndex = null;
            renderAll();

            document.getElementById('ball-container').classList.remove('active');

            setTimeout(() => {
                showWinners(prize, winners);
                launchFireworks();
            }, 300);

            const btn = document.getElementById('lottery-btn');
            btn.disabled = false;
            btn.textContent = 'üé∞ ÂºÄÂßãÊäΩÂ•ñ';
            btn.classList.remove('running');
        }

        function cancelLottery() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }

            const ball = document.getElementById('lottery-ball');
            ball.style.animation = 'none';

            document.getElementById('ball-container').classList.remove('active');

            const btn = document.getElementById('lottery-btn');
            btn.disabled = false;
            btn.textContent = 'üé∞ ÂºÄÂßãÊäΩÂ•ñ';
            btn.classList.remove('running');
        }

        function showWinners(prize, winners) {
            const modal = document.getElementById('winner-modal');
            document.getElementById('winner-prize').textContent = `Â•ñÂìÅÔºö${prize.desc}`;
            document.getElementById('winner-names').innerHTML = winners.map(w =>
                `<div class="winner-name">${w.name}</div>`
            ).join('');
            modal.classList.add('active');
        }

        document.getElementById('winner-modal').addEventListener('click', () => {
            document.getElementById('winner-modal').classList.remove('active');
        });

        function launchFireworks() {
            const container = document.getElementById('fireworks-container');
            const colors = ['#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#1dd1a1', '#ff6ff3'];

            for (let i = 0; i < 50; i++) {
                setTimeout(() => createFirework(container, colors), i * 100);
            }
        }

        function createFirework(container, colors) {
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight * 0.6;
            const color = colors[Math.floor(Math.random() * colors.length)];

            const center = document.createElement('div');
            center.style.cssText = `position:absolute;left:${x}px;top:${y}px;width:8px;height:8px;background:${color};border-radius:50%;`;
            container.appendChild(center);

            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                const angle = (Math.PI * 2 / 30) * i;
                const velocity = 80 + Math.random() * 120;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                particle.style.cssText = `position:absolute;left:${x}px;top:${y}px;width:6px;height:6px;background:${color};border-radius:50%;animation:fireworkParticle 1s ease-out forwards;--tx:${tx}px;--ty:${ty}px;`;
                container.appendChild(particle);
            }

            setTimeout(() => {
                center.remove();
                container.querySelectorAll('[style*="fireworkParticle"]').forEach(p => p.remove());
            }, 1000);
        }

        const style = document.createElement('style');
        style.textContent = '@keyframes fireworkParticle {0%{transform:translate(0,0);opacity:1}100%{transform:translate(var(--tx),var(--ty));opacity:0}}';
        document.head.appendChild(style);

        function showSettings() { document.getElementById('settings-panel').classList.add('active'); }
        function closeSettings() { document.getElementById('settings-panel').classList.remove('active'); }

        function saveTitle() {
            const title = document.getElementById('setting-title').value.trim();
            settings.title = `üéâ ${title} üéä`;
            saveData();
            renderTitle();
            alert('Ê†áÈ¢òÂ∑≤‰øùÂ≠ò');
        }

        function addPeople() {
            const text = document.getElementById('add-people-text').value.trim();
            if (!text) { alert('ËØ∑ËæìÂÖ•ÂßìÂêç'); return; }
            const names = text.split('\n').map(n => n.trim()).filter(n => n);
            const newPeople = names.map(name => ({ id: Date.now() + Math.random(), name, prize: null }));
            people = [...people, ...newPeople];
            saveData();
            renderAll();
            document.getElementById('add-people-text').value = '';
            alert(`ÊàêÂäüÊ∑ªÂä† ${newPeople.length} Âêç‰∫∫Âëò`);
        }

        function clearPeople() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâ‰∫∫ÂëòÂêóÔºü')) {
                people = [];
                saveData();
                renderAll();
            }
        }

        function exportPeople() {
            downloadFile(people.map(p => p.name).join('\n'), '‰∫∫ÂëòÂêçÂçï.txt', 'text/plain');
        }

        function showImportModal() { document.getElementById('import-modal').classList.add('active'); }
        function closeImportModal() { document.getElementById('import-modal').classList.remove('active'); }
        function showImportAllModal() { document.getElementById('import-all-modal').classList.add('active'); }
        function closeImportAllModal() { document.getElementById('import-all-modal').classList.remove('active'); }

        document.getElementById('import-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const content = ev.target.result;
                    let names = [];
                    if (file.name.endsWith('.json')) {
                        const data = JSON.parse(content);
                        names = Array.isArray(data) ? data.map(item => typeof item === 'string' ? item : item.name) : [];
                    } else {
                        names = content.split('\n').map(l => l.trim()).filter(l => l);
                    }
                    const newPeople = names.map(name => ({ id: Date.now() + Math.random(), name, prize: null }));
                    people = [...people, ...newPeople];
                    saveData();
                    renderAll();
                    alert(`ÊàêÂäüÂØºÂÖ• ${newPeople.length} Âêç‰∫∫Âëò`);
                } catch (err) { alert('Êñá‰ª∂Ê†ºÂºèÈîôËØØ'); }
                closeImportModal();
            };
            reader.readAsText(file);
        });

        document.getElementById('import-all-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                try {
                    const data = JSON.parse(ev.target.result);
                    people = data.people || [];
                    prizes = data.prizes || [];
                    history = data.history || [];
                    settings = data.settings || settings;
                    saveData();
                    renderAll();
                    alert('ÈÖçÁΩÆÂØºÂÖ•ÊàêÂäü');
                } catch (err) { alert('ÈÖçÁΩÆÊñá‰ª∂Ê†ºÂºèÈîôËØØ'); }
                closeImportAllModal();
            };
            reader.readAsText(file);
        });

        function exportAll() {
            const data = {
                people,
                prizes,
                history,
                settings: {
                    title: settings.title,
                    background: settings.background
                },
                exportTime: new Date().toISOString()
            };
            downloadFile(JSON.stringify(data, null, 2), 'ÊäΩÂ•ñÁ≥ªÁªüÈÖçÁΩÆ.json', 'application/json');
        }

        function clearAll() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                people = [];
                prizes = [];
                history = [];
                settings = { title: 'üéâ Âπ¥‰ºöÊäΩÂ•ñÁ≥ªÁªü üéä', background: 'gradient1' };
                saveData();
                renderAll();
                closeSettings();
            }
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        document.querySelectorAll('.settings-panel').forEach(panel => {
            panel.addEventListener('click', (e) => {
                if (e.target === panel) panel.classList.remove('active');
            });
        });
    </script>
</body>
</html>